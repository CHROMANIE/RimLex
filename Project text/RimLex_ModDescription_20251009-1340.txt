RimLex – UI Text Localizer
ワークショップ公開用説明テキスト / 概要・特徴・導入方法・翻訳手順
作成: 2025-10-09 13:40 (JST)
対象: RimWorld 1.5 / 1.6, .NET Framework 4.7.2, Harmony 2.x
実装版: 0.10.0-rc6a（収集安定版・/n正規化対応）
ドキュメント版: v3
Based on SHA256 (prev: RimLex_ModDescription_20251007-1300.txt): **8d5a3a1f7f2b46c6c0bfb1e0c7b4aa6f0a9a1b7f9f7b3db59a77a9f3a1c3b2e0**

――――――――――――――――――――――――――――――――――――

【このModは何をする？】
RimLex は、**ゲーム画面に実際に描画された英語UI**をその場で収集し、**辞書（TSV）**にもとづいて日本語へ**実行時に置換**するローカライザです。翻訳キーやXMLを持たないMODでも、ボタン・ラベル・ツールチップ・右クリックメニュー・GizmoなどのUIテキストを**自然な日本語**にできます。

・翻訳は「見えた文字」に対して即時適用（ApplyDictAtRuntime）。
・未訳は自動収集してファイルに出力。
・**Per-Mod 出力**と**集約(_All)**の両方をサポート。
・辞書はシンプルな **「英語<TAB>日本語」** 形式。**改行は `/n`**。
・数字は自動で **`#` プレースホルダ**化（例: `Valid range: # - #`）。訳側の `#` に元の数値が復元されます。

――――――――――――――――――――――――――――――――――――

【主な特徴】
・対応UI：Label / Button / Tooltip（string & TipSignal）/ FloatMenu / Gizmo（LabelCap）/ Slider（安全化）
・**収集の安定化**：自己参照（RimLexの設定画面）や開発者ログ等は**常時除外**。
・**/n 正規化（rc6）**：辞書や収集で `/n` と `\n` を**同一視**。TXT/TSVは `/n` で一行化。
・**数字の形状化**：どの値でも1つの辞書で対応（`#` を左から復元）。
・**ノイズ除去**：URL/空行/純数字/記号列/日本語支配行などを収集対象外に。
・**辞書ホットリロード**：保存すれば即反映（FileSystemWatcher）。
・**一括整備**：未訳一覧生成・集約再構築・TSVテンプレ自動生成。
・**安全なI/O**：アトミック書換（`.tmp`→`Move`）とデバウンスで高速・堅牢。

――――――――――――――――――――――――――――――――――――

【動作条件】
・RimWorld 1.5 / 1.6
・.NET Framework 4.7.2（Unity同梱）
・Harmony 2.x（必須）

――――――――――――――――――――――――――――――――――――

【インストール】

1. RimLex を通常のMODとして導入（ワークショップ/ローカルどちらも可）。
2. Mod一覧で **Harmony → RimLex** の順にロード。
3. ゲームを起動すると、RimLex が自動でUIフックを適用（起動ログに `Patched:` が6系統出ます）。

――――――――――――――――――――――――――――――――――――

【設定（Mod設定 → RimLex）】
・**辞書を再読み込み**：`Dict/strings_ja.tsv` を即再読込。
・**未訳一覧を生成**：`Export/_All/untranslated.txt` を再構築。
・**整理**：Per-Mod 集約ファイル（`texts_en_aggregate.txt` / `grouped_by_mod.txt`）を再構築。
・**未訳からTSV雛形を作成**：`Dict/strings_ja_template.tsv` を出力（左列に `/n` 一行化済み英語、右列空欄）。
・**フォルダを開く**：`Dict/` / `Export/PerMod/` / `Export/_All/` を開く。
・**収集をリセット**：`Export/` を空にして再作成（**辞書は消えません**）。
・**ログを開く**：`RimLex.log` をOS既定アプリで開く。
・**SelfTest**：I/Oの健康診断（`Export/SelfTest` に出力）。
・ステータス表示：**直近セッション**と**合計（起動〜）**の `置換 / 収集 / 除外 / I/O` を表示。
・高度設定（RimLex.ini）：Included/ExcludedWindows、PauseAggregate、AggregateDebounceMs、WatchDict、PerModSubdir 等。

――――――――――――――――――――――――――――――――――――

【翻訳の流れ（最短ルート）】

1. 遊ぶ（または各MODの設定画面を開く）→ RimLex が**見えた英語を自動収集**。

   * PerMod: `Export/PerMod/<Mod>/texts_en.txt` / `strings_en.tsv`
   * 集約: `Export/_All/texts_en_aggregate.txt`
2. 設定画面で **未訳一覧を生成** → `Export/_All/untranslated.txt` を得る（**/n一行**）。
3. **未訳からTSV雛形を作成** → `Dict/strings_ja_template.tsv` を開き、右列に訳を書く。

   * **改行は `/n`** を残す。数字は `#` を含むテンプレでOK（復元されます）。
4. そのまま `Dict/strings_ja.tsv` に追記/上書き → **辞書を再読み込み**。
5. 画面に戻ると**即時置換**されています。

――――――――――――――――――――――――――――――――――――

【辞書の書き方】
・形式：**英語<TAB>日本語**（TSV）
・改行：`/n`（スラッシュ+小文字n）。RimLexは `/n` と `\n` のどちらでもヒット。
・数字：`#`（例：`Valid range: # - #	有効範囲：#～#`）
・注意：URL、MOD名、作者名、バージョンは翻訳しない方針。

――――――――――――――――――――――――――――――――――――

【出力ファイル（自動生成）】
・`Export/PerMod/<Mod>/texts_en.txt` … **/n 一行**の英語一覧
・`Export/PerMod/<Mod>/strings_en.tsv` … `timestamp_utc mod source scope text`
・`Export/_All/texts_en_aggregate.txt` … 軽量追記＋「整理」で再構築
・`Export/_All/untranslated.txt` … **未訳のみ**（/n 一行）
・`Export/_All/grouped_by_mod.txt` … Mod別にまとめた英語

――――――――――――――――――――――――――――――――――――

【既知の仕様】
・RimLex の設定画面は**収集・置換の対象外**（自己参照ループ防止）。
・Slider は**安全化のみ**（収集しません）。スライダーで動く数字は `#` で統一収集。
・一部のトップレベルUIは `Unknown(Harmony/Verse)` に分類されることがあります（無害）。
・辞書の重複（同英語→異訳）の検出は**次フェーズで拡充予定**。

――――――――――――――――――――――――――――――――――――

【FAQ】
Q. 辞書で `/n` を入れ忘れて `\n` と書いた。置換は効く？
A. 効きます。RimLex は `/n` と `\n` を**同一視**して照合します。

Q. ツールチップ内の数値（例：`Default: 120`）はどうなる？
A. 収集時に**`#`**へ形状化されます。訳では `Default: #` と書けば、描画時に**元の数値**が復元されます。

Q. 収集が暴走して数値が増え続ける？
A. RimLex 設定画面は除外済み。スライダー連打などの動的変化も**デバウンス**で抑止します。

Q. Export をリセットすると何が消える？
A. `Export/` 以下のみ。**辞書（Dict）やログは消えません**。

――――――――――――――――――――――――――――――――――――

【変更履歴（抜粋）】
・0.10.0-rc6/rc6a（2025-10-09）
　- **/n 正規化**の強化：辞書／照合で `/n` / `\n` / `/ n` を同一視。
　- **自己参照の恒久除外**：RimLex 設定画面の収集・置換を完全停止。
　- **数字の形状化**の安定化：ツールチップ含め自然に復元。
　- **ノイズ除外の精密化**：画面単位BL/WH、CJK比率で日本語行を収集対象外に。
　- **集約I/Oの堅牢化**：アトミック書換＋デバウンス。
　- **未訳TSVテンプレ生成**ボタンを追加。
　- （rc6a）再構築メソッドの `out` 初期化修正（CS0177 対応）。

――――――――――――――――――――――――――――――――――――

【クレジット】
・開発：RimLex Project（えーいち + GPT）
・パッチ基盤：Harmony（pardeike 他）
・ライセンス：ワークショップページ記載のライセンスに従います。

――――――――――――――――――――――――――――――――――――

【サポート】
・`RimLex.log` と `Export/_All/untranslated.txt` を添えて報告してください。
・再現手順／使用MODリスト／RimWorldバージョンがあると解析が速くなります。

――――――――――――――――――――――――――――――――――――

【今後（次フェーズの計画）】
・**恒久由来インデックス**（`Dict/Index/en_provenance.tsv`）でMOD由来を蓄積。
・**MOD別辞書の分割/統合**（配布や掃除が容易に）。
・**重複キー検出・陳腐化レポート・辞書ソート**のUI統合。
・（研究）ドロップダウン候補の**事前収集**、Gizmo説明文の網羅。

――――――――――――――――――――――――――――――――――――

以上。
このテキストは**そのままワークショップの説明欄**として使用できます（行頭装飾は必要に応じて調整してください）。

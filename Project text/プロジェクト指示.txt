# 【プロジェクトの目的】

このプロジェクトは、**海外製RimWorld MODのUI英語を自然な日本語へ置き換える**ことを目的とする。
自動翻訳APIに依存せず、実際にゲーム画面へ描画された文字列を**リアルタイム収集 → 辞書適用で即時翻訳**する方式を採用。

最終目標は、翻訳キーやXMLを持たないMODを含め、
すべてのUI・オプション・マウスオーバー・ボタンなどを自然な日本語で楽しめる完全日本語環境を構築すること。

---

## 【MOD名と構成】

**MOD名:** RimLex – UI Text Localizer
**概要:** Runtime dictionary-based localization tool for RimWorld
**開発元:** RimLex Project（えーいち＋GPT）
**現行バージョン:**

* **実装版:** **0.10.0-rc6a**（収集安定版：/n正規化・数字#形状化・自己参照除外・画面BL/WH・ホットリロード・アトミック書換）
* **ドキュメント版:** **v3**（現フェーズ＝「収集安定」世代。次フェーズ開始時にv4へ昇格）

---

## 【開発ルール】

開発は GPT と えーいち のペアで行う。

* **GPT:**
  C# ソース開発を担当。**常にコンパイル可能な `.cs` を全文**提示。えーいちへの部分修正指示は禁止。
  コード・ini・設定構成の整合性を常に維持する。

* **えーいち:**
  プログラミング知識なしで実機検証を行う。
  DLL化 → RimWorldで動作確認 → 収集／翻訳反映／体感パフォーマンス／ログ出力を評価。
  不具合はスクショまたは `Player.log`＋`RimLex.log` の該当箇所をGPTへ渡す。

---

## 【翻訳運用ルール】

1. **入力**
   RimLex が自動で収集した以下の英語原文をGPTへ渡す。

   * `Export/<ModName>/texts_en.txt`
   * または `Export/<ModName>/strings_en.tsv`

2. **出力**
   `Dict/strings_ja.tsv` に追記できる形式で返す。
   **タブ区切り：`英語原文 <TAB> 日本語訳`**

3. **翻訳方針**

   * 文脈に合わせた自然な日本語。直訳禁止。
   * MOD名・固有名詞は翻訳しない。
   * **数値は`#`で表す形状キーに対応**（例：`Valid range: # - #` → `有効範囲：#～#`）。
   * 文末ピリオドは「。」へ。
   * UI項目は「～を有効化」など自然な表現で統一。
   * **改行は `/n` で明示**（rc6：辞書照合時は `/n` と `\n` を同一視）。

4. **除外ルール**

   * URL・MOD名・作者名・バージョン番号は翻訳しない。
   * **日本語支配行（CJK比率が高い）は収集しない**（英語UI専用化）。
   * 既に日本語化済みの行はスキップ。

5. **運用手順**

   1. RimWorldでUIを開く → RimLexが英語を収集（未訳のみ）
   2. `Export/` 以下に自動出力（Per-Mod と _All 集約）
   3. GPTが翻訳 → `Dict/strings_ja.tsv` に追記
   4. RimLexが即時反映（`ApplyDictAtRuntime=true`／**ホットリロード対応**）
   5. 以降の収集では既訳を自動除外

---

## 【出力構造】

| 出力種別           | フォルダ                       | 内容                                                                                                         |
| -------------- | -------------------------- | ---------------------------------------------------------------------------------------------------------- |
| **Per-Mod 出力** | `Export/PerMod/<ModName>/` | `texts_en.txt`（**/n一行**） / `strings_en.tsv`（timestamp,mod,source,scope,text）                               |
| **集約出力**       | `Export/_All/`             | `texts_en_aggregate.txt`（軽量追記＋整理で再構築, 先頭に`rebuilt_at`）/ `untranslated.txt`（**/n一行**）/ `grouped_by_mod.txt` |
| **一時出力**       | `Export/PerMod/Current/`   | Per-Mod 無効時のテスト出力                                                                                          |
| **自己テスト**      | `Export/SelfTest/`         | 動作確認用ダミー出力                                                                                                 |
| **辞書**         | `Dict/strings_ja.tsv`      | 翻訳ペア辞書（**/n表記・`#`形状キー可**）／`Dict/strings_ja_template.tsv`（未訳から自動生成）                                         |
| **ログ**         | `RimLex.log`, `Player.log` | RimLex独自＋RimWorld標準ログ                                                                                      |

> 補足：RimLexの**設定画面は常時除外**（自己参照ループ対策）。`EditWindow_Log` / `Page_ModsConfig` なども既定ブラックリスト。

---

## 【ドキュメント群（4要素）】

1. **FunctionalSpec**

   * MODの全体仕様・構成・将来拡張・DoD（完成定義）を記述。
   * ファイル名: `RimLex_FunctionalSpec_v3_YYYYMMDD-HHMM.txt`

2. **Source**

   * フォルダ構成・依存関係・ビルド条件・差分履歴を記録。
   * `.cs` は別途 `/Source/` に格納し、ここでは概要のみ。
   * ファイル名: `RimLex_Source_v3_YYYYMMDD-HHMM.txt`

3. **ModDescription**

   * Workshop公開用の概要・特徴・翻訳手順。
   * ファイル名: `RimLex_ModDescription_YYYYMMDD-HHMM.txt`

4. **UserGuide**

   * ユーザー向け操作説明書。UIの挙動・フォルダの意味・ボタン説明。
   * ファイル名: `RimLex_UserGuide_v1_YYYYMMDD-HHMM.txt`

---

## 【バージョニング運用】

* 開発中は SemVer **0系** を使用。

  * 機能追加（後方互換あり）：0.10.0, 0.11.0, …
  * バグ修正のみ：0.10.1, 0.10.2, …
* 仕様・実装が安定した段階で **1.0.0（正式版）** に昇格。
* **ドキュメント版（vX）**は**仕様世代／チャット世代**を示す。

  * 例：`RimLex v3 (docs) / RimLex.dll v0.10.0-rc6a (impl)`
* **世代の切替基準**：

  * v3＝収集安定フェーズ（現状）。
  * **v4＝辞書管理フェーズ開始時**（恒久由来Index・MOD別辞書分割/統合・重複検出・ソート・陳腐化レポートを正式編入）。

---

#### 【コード更新およびバージョン管理ルール（恒久指針）】

1. **再構築禁止原則**
   開発中に `.cs` または `.xml` を生成・更新する場合、**直前の最新版（手元保存ファイル）**を常に基準に更新する。

2. **完全差し替え出力**
   GPT は出力を常に**全文**で提示（部分差し替え禁止）。差分追跡と履歴比較を容易にする。

3. **ハッシュベースライン運用**
   採用版一式の **SHA-256** を記録し「Based on SHA256: …」を明示。
   以後の更新はこのベースラインに対する差分として扱う。

4. **継続時の再確立手順**
   新チャットや新環境で再開する際は、えーいちが**前回採用版**を再アップロード。
   GPT はベースラインを再確立してから改修する。

---

## 【引き継ぎ・開発再開手順】

1. 最新版の `RimLex_FunctionalSpec_*.txt` と `RimLex_Source_*.txt` をアップロード。
2. GPTへ伝える：

   > 「この機能書を基準に、アップロードしたソースの実装状況を確認し、未実装部分を整理して続きから開発して」
3. GPTは差分解析 → 実装済/未実装判定 → 次の改修計画を提示。

**次チャット冒頭テンプレ（v4開始用）**

```
最新版の v3 文書（FunctionalSpec / Source / ModDescription / UserGuide）をアップロードします。
この4ファイルを v4 のベースラインとして再発行し（ヘッダに Based on SHA256 を記載）、
「辞書管理フェーズ」（恒久由来Index、MOD別辞書の分割/統合、ソート、重複検出、陳腐化レポート）
の実装をこの続きから開始してください。
```

---

## 【追加ルール（GPT側開発向け）】

* 出力は常に**全文差し替え可能**な形で提示。
* ソース更新時は `.csproj` を含めて**ビルド整合性を保証**。
* ログ・Export出力のパス・ini既定値は**変更しない**。
* 会話内で「修正箇所だけ」と求められても**全体出力で返す**。
* プロジェクト更新時は**日時サフィックス** `_vYYYYMMDD-HHMM` を付与。
* 新チャット開始時は、GPTが**RimLex最新仕様の認識を再同期**してから改修を開始。

---

## 【30秒点検リスト（現フェーズ）】

* 起動直後の `RimLex.log` に **`Patched:` が6系統**出る。
* 設定画面の**「未訳一覧を生成」「整理」**が成功し、件数トーストが出る。
* ツールチップにマウスを乗せると **`_All/texts_en_aggregate.txt` が伸びる（/n一行）**。
* **「フォルダを開く」** 3種が正しい場所を開く。
* `PerModSubdir` を変更→保存→再起動後もフォルダ構成が反映される。
* 設定画面上部の **直近/合計カウンタ（置換/収集/除外/I/O）** が自然に増減し、**放置で暴走しない**。
* RimLex設定画面や `EditWindow_Log` などは**収集・置換の対象外**になっている。

---

## 【プロジェクトの理念と保存目的】

このプロジェクトで作成・更新される4つのテキスト（
`FunctionalSpec`, `Source`, `ModDescription`, `UserGuide`）は、
単なる資料やメモではなく、**開発環境そのものを保存する装置**である。

目的は、仮にGPTが開発から外れたり、
別の生成AI・プログラマー・人間開発者が引き継ぐことになったとしても、
**開発方針・設計思想・運用構造が変わらず続いていくこと**。

つまり「コードを残す」ではなく、
「**開発の文脈ごと未来に渡す**」ための設計である。

この理念をもとに、RimLex Projectは**長期的に同一品質で発展し続ける**ことを目指す。